<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Boldog sz√ºlet√©snapot, Andi!</title>
  <style>
    :root{
      --bg1:#0f1021;
      --bg2:#1b1c3a;
      --accent:#ff5fa2;
      --accent2:#ffd166;
      --box:#7cb7ff;
      --box-dark:#5a8fdd;
      --card:#ffffff;
      --text:#f8f8ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 20%, #1d2050 0%, var(--bg1) 60%, #0b0c1d 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;overflow:hidden}

    canvas.fx{position:fixed;inset:0;z-index:0;pointer-events:none}

    .stage{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;z-index:10;padding-top:clamp(18px,4vh,40px);}

    /* C√çMSOR ‚Äì kirak√≥s helye (a ‚ÄûAndi‚Äù marad fixen) */
    h1{margin:0 12px 12px;font-weight:800;letter-spacing:0.3px;text-align:center;font-size:clamp(20px,4.8vw,36px)}
    h1 .name{color:var(--accent2)}
    #assembled{display:inline-flex;gap:.18em;min-height:1em}
    .letter-slot{
      min-width:0.6em; display:inline-flex; align-items:center; justify-content:center;
      border-bottom:2px dashed #ffffff33; color:#fff; font-weight:900;;
    }
    .letter-slot.space{border-bottom:none; width:.4em}
    .letter-slot.filled{border-bottom-color:transparent; color:#fff}

    .scene{position:relative;display:grid;place-items:center;width:100%;height:100%;padding-bottom:22vh}

    /* Aj√°nd√©kdoboz */
    #gift{position:relative;width:min(68vw,360px);height:min(52vw,275px);cursor:pointer;}
    #gift .box{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:88%;height:70%;background:linear-gradient(180deg,var(--box) 0%, var(--box-dark) 100%);border-radius:12px 12px 16px 16px;box-shadow:0 14px 40px rgba(0,0,0,.35), inset 0 -6px 14px rgba(0,0,0,.25);}
    #gift .box::before{content:"";position:absolute;inset:0 0;left:calc(50% - 8px);width:16px;background:linear-gradient(180deg,var(--accent) 0%, #ff3f8c 100%);border-radius:10px}
    #gift .box::after{content:"";position:absolute;top:40%;left:0;right:0;height:16px;background:linear-gradient(180deg,var(--accent) 0%, #ff3f8c 100%);}
    #gift .lid{position:absolute;bottom:66%;left:50%;transform:translateX(-50%) rotateX(0deg);transform-origin:50% 100%;width:98%;height:32%;background:linear-gradient(180deg,var(--box-dark) 0%, #3b64b8 100%);border-radius:14px;box-shadow:0 8px 20px rgba(0,0,0,.35);transition:transform .9s cubic-bezier(.2,.9,.1,1), filter .4s;}
    #gift .lid::before{content:"";position:absolute;left:calc(50% - 10px);width:20px;top:0;bottom:0;background:linear-gradient(180deg,var(--accent) 0%, #ff3f8c 100%);border-radius:10px}
    #gift .glow{position:absolute;inset:auto 8% 60% 8%;height:0;border-radius:12px;filter:blur(14px);opacity:.0;transition:opacity .6s}
    #gift.open .glow{opacity:.6;animation:glowPulse 1.4s ease-in-out infinite alternate}
    @keyframes glowPulse{from{box-shadow:0 0 40px 8px rgba(255,255,255,.0),0 0 140px 30px rgba(255,219,90,.0)}to{box-shadow:0 0 60px 12px rgba(255,255,255,.25),0 0 220px 46px rgba(255,219,90,.25)}}
    #gift.open .lid{transform:translateX(-50%) rotateX(70deg) rotateZ(0.4deg)}

    /* Aj√°nd√©kk√°rty√°k */
    .cards{position:absolute;left:50%;bottom:28%;transform:translateX(-50%) translateY(20px) scale(0.96);display:flex;gap:12px;pointer-events:none}
    .card{width:clamp(120px,28vw,170px);aspect-ratio:5/7;background:var(--card);color:#222;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:12px 10px;text-align:center;font-weight:700;line-height:1.2;opacity:0;transform:translateY(30px) rotate(-3deg);transition:transform .8s cubic-bezier(.2,.9,.1,1), opacity .6s}
    .card b{display:block;color:#e63978;margin-bottom:6px}
    .card:nth-child(2){transform:translateY(30px) rotate(5deg)}
    #gift.open .card{opacity:1;transform:translateY(-42px) rotate(-6deg)}
    #gift.open .card:nth-child(2){transform:translateY(-32px) rotate(6deg)}

    /* Lufik kont√©ner √©s lufi st√≠lus (repked≈ës) */
    .balloons{position:fixed;inset:0;pointer-events:none}
    .balloon{
      position:absolute; width:clamp(36px,8vw,64px); aspect-ratio:1/1.25;
      background:radial-gradient(60% 70% at 50% 30%, #fff8 0%, transparent 70%), var(--col, #ff7aa2);
      border-radius:50% 50% 46% 46% / 56% 56% 44% 44%;
      box-shadow:0 6px 18px rgba(0,0,0,.35); pointer-events:auto;
      display:flex; align-items:center; justify-content:center; font-weight:900; color:#111; user-select:none;
      transition:none;            /* <<< g√∂rd√ºl√©keny rAF anim√°ci√≥hoz */
      will-change:transform;      /* <<< GPU-gyors√≠t√°s */
    }
    .balloon:after{content:"";position:absolute;bottom:-24%;left:50%;width:2px;height:32%;background:#ddd;transform:translateX(-50%)}
    .balloon .shine{position:absolute;top:14%;left:26%;width:14%;height:20%;border-radius:50%;background:#ffffffaa;filter:blur(2px)}
    .balloon.popped{transform:scale(0); opacity:0; pointer-events:none; transition:transform .25s ease, opacity .25s ease}

    /* Rep√ºl≈ë bet≈± anim (ballonb√≥l a hely√©re) */
    .fly-letter{
      position:fixed; left:0; top:0; transform:translate(-50%,-50%);
      font-weight:900; font-size:clamp(18px,6vw,28px); color:#fff; z-index:15;
      transition:transform .7s cubic-bezier(.2,.9,.1,1), opacity .7s;
      text-shadow:0 4px 14px rgba(0,0,0,.5);
    }

    .deck{position:relative}
    .shadow{position:absolute;bottom:8%;left:50%;transform:translateX(-50%);width:min(68vw,360px);height:18px;background:radial-gradient(closest-side,rgba(0,0,0,.5),transparent);filter:blur(2px);opacity:.7}
    .hint{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-size:12px;color:#cfd3ff99;background:rgba(255,255,255,.04);padding:6px 10px;border:1px solid rgba(255,255,255,.06);border-radius:999px;backdrop-filter:blur(6px);z-index:20}

    @media (min-width:800px){
      .scene{padding-bottom:8vh}
      #gift{width:min(40vw,420px);height:min(30vw,300px)}
      .shadow{width:min(40vw,420px)}
    }

    /* Fels≈ë, lekerek√≠tett modal ‚Äì feladatle√≠r√°s */
    .modal-backdrop{
      position:fixed; inset:0; display:grid; place-items:center; background:#0008; z-index:50; opacity:0; pointer-events:none; transition:opacity .25s;
    }
    .modal-backdrop.show{opacity:1; pointer-events:auto;}
    .modal-card{
      width:min(92vw,520px); background:#1a1b39; color:#fff; border-radius:18px; box-shadow:0 20px 60px #0007; padding:18px 16px 14px;
      border:1px solid #ffffff14;
    }
    .modal-card h2{margin:6px 0 8px; font-size:clamp(18px,5vw,22px)}
    .modal-card p{margin:0 0 12px; color:#cdd1ffcc; line-height:1.4}
    .modal-actions{display:flex; justify-content:flex-end; gap:10px}
    .btn{
      appearance:none; border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer;
      background:linear-gradient(180deg, #ff69a6, #ff3f8c); color:#fff; box-shadow:0 8px 20px rgba(255,63,140,.35);
    }
    .btn.secondary{background:#ffffff12; color:#fff; box-shadow:none}
  </style>
</head>
<body>
  <!-- H√°tt√©r effektek: t≈±zij√°t√©knak + konfetti -->
  <canvas id="fireworks" class="fx"></canvas>
  <canvas id="confetti" class="fx"></canvas>

  <!-- Feladat-ismertet≈ë modal -->
  <div id="taskModal" class="modal-backdrop show">
    <div class="modal-card">
      <h2>üéà Mini j√°t√©k</h2>
      <p>Kattints a repked≈ë lufikra! Minden lufib√≥l el≈ëbukkan egy bet≈± a ‚Äû<b>Boldog sz√ºlet√©snapot</b>‚Äù feliratb√≥l.<br>
      A bet≈± a hely√©re rep√ºl, √©s ha a teljes sz√∂veg √∂ssze√°ll, <b>kinyithatod az aj√°nd√©kdobozt.</b></p>
      <div class="modal-actions">
        <button class="btn" id="okBtn">Mehet!</button>
      </div>
    </div>
  </div>

  <div class="stage">
    <h1><span id="assembled"></span>, <span class="name">Andi</span> üéâ</h1>

    <div class="scene">
      <div class="deck">
        <div id="gift" aria-label="Aj√°nd√©kdoboz (koppints a nyit√°shoz)" role="button">
          <div class="lid"></div>
          <div class="box"></div>
          <div class="glow"></div>

          <!-- Aj√°nd√©k k√°rty√°k -->
          <div class="cards">
            <div class="card"><div><b>Aj√°nd√©k kupon</b>matcha te√°z√°s<br>üçµ</div></div>
            <div class="card"><div><b>Aj√°nd√©k kupon</b>IKONO bel√©p≈ë<br>üì∏</div></div>
          </div>

          <!-- Lufik (JS t√∂lti fel a bet≈±k alapj√°n) -->
          <div class="balloons" aria-hidden="true" id="balloons"></div>
        </div>
        <div class="shadow"></div>
      </div>
    </div>
  </div>

  <div class="hint">Feladat: rakd ki a ‚ÄûBoldog sz√ºlet√©snapot‚Äù sz√∂veget a lufikb√≥l! üéà</div>

  <script>
  /* ======== C√çMSOR KIRAK√ìS (bet≈±helyek) ======== */
  const targetText = "Boldog sz√ºlet√©snapot";
  const assembled = document.getElementById('assembled');
  const slots = [];
  for(const ch of targetText){
    const span = document.createElement('span');
    span.className = 'letter-slot' + (ch === ' ' ? ' space' : '');
    span.dataset.expected = ch;
    span.textContent = ch === ' ' ? '' : ' ';
    assembled.appendChild(span);
    slots.push(span);
  }
  let filledCount = 0, totalLetters = targetText.replace(/\s/g,'').length;
  function isPuzzleComplete(){ return filledCount >= totalLetters; }

  /* ======== Aj√°nd√©k doboz nyit√°s ‚Äì Nincs r√°z√°s, ha nem k√©sz a felirat ======== */
  const gift = document.getElementById('gift');
  let opened = false;
  gift.addEventListener('click', (e) => {
    if (e.target.classList.contains('balloon')) return;
    if (!isPuzzleComplete()) return; // <<< csak ez marad, nincs ‚Äûshake‚Äù
    if (!opened){
      opened = true;
      gift.classList.add('open');
      startFireworks(5600);
      burstConfetti(180);
      setTimeout(()=>burstConfetti(80),900);
      setTimeout(()=>burstConfetti(80),1800);
    } else {
      burstConfetti(30);
    }
  }, {passive:true});

  /* ======== LUFIK: l√©trehoz√°s (egy lufi = egy bet≈±, v√©letlen indul√≥ poz√≠ci√≥k) ======== */
  const balloonsWrap = document.getElementById('balloons');
  const colors = ['#ff7aa2','#6ee7ff','#ffd166','#a3ff9b','#c084fc','#f472b6','#22d3ee'];
  const letters = targetText.replace(/\s/g,'').split('');
  const balloonState = [];

  function rand(min,max){ return Math.random()*(max-min)+min; }

  letters.forEach((letter,i)=>{
    const b = document.createElement('div');
    b.className = 'balloon';
    b.style.setProperty('--col', colors[i % colors.length]);
    // kezd≈ë poz√≠ci√≥
    const x = rand(10, innerWidth - 70);
    const y = rand(60, innerHeight - 200);
    b.style.left = x+'px';
    b.style.top  = y+'px';
    b.dataset.letter = letter;
    const shine = document.createElement('div'); shine.className='shine'; b.appendChild(shine);
    balloonsWrap.appendChild(b);

    // M√âRET cache ‚Äì ne k√©rdezz√ºk minden frame-ben (sim√°bb mobilon)
    const rect = b.getBoundingClientRect();

    balloonState.push({
      el:b,
      x, y,
      baseLeft:x, baseTop:y,   // a translate-hez
      w:rect.width, h:rect.height,
      vx: rand(-1.2,1.2), vy: rand(-1.0,1.0),
      nextTurnAt: performance.now() + rand(300,900)
    });
  });

  /* ======== LUFIK MOZG√ÅSA: gyors ir√°nyv√°lt√°sok, pattog√°s a sz√©leken ======== */
  const LEFT_WALL = 0, TOP_WALL = 0;
  function motionLoop(ts){
    const RIGHT_WALL = innerWidth, BOTTOM_WALL = innerHeight;
    for(const b of balloonState){
      // id≈ënk√©nt hirtelen √∫j ir√°ny
      if(ts >= b.nextTurnAt){
        const speed = rand(0.8, 1.8);
        const angle = rand(0, Math.PI*2);
        b.vx = Math.cos(angle)*speed;
        b.vy = Math.sin(angle)*speed;
        b.nextTurnAt = ts + rand(280, 800);
      }
      // mozg√°s
      b.x += b.vx;
      b.y += b.vy;

      // falak: pattog√°s
      if(b.x < LEFT_WALL){ b.x = LEFT_WALL; b.vx = Math.abs(b.vx)*0.9; }
      if(b.x + b.w > RIGHT_WALL){ b.x = RIGHT_WALL - b.w; b.vx = -Math.abs(b.vx)*0.9; }
      if(b.y < TOP_WALL+40){ b.y = TOP_WALL+40; b.vy = Math.abs(b.vy)*0.9; }
      if(b.y + b.h > BOTTOM_WALL-40){ b.y = BOTTOM_WALL - 40 - b.h; b.vy = -Math.abs(b.vy)*0.9; }

      // csak transform, subpixel engedve + GPU hint (translate3d)
      b.el.style.transform = `translate3d(${(b.x - b.baseLeft)}px, ${(b.y - b.baseTop)}px, 0)`;
    }
    requestAnimationFrame(motionLoop);
  }
  requestAnimationFrame(motionLoop);

  /* ======== LUFIK KATTINT√ÅS: ‚Äûpukkan√°s‚Äù + bet≈± berep√ºl a hely√©re ======== */
  function flyLetterToSlot(ch, fromX, fromY){
    const target = slots.find(s => !s.classList.contains('filled') && s.dataset.expected === ch);
    if(!target) return;
    const tRect = target.getBoundingClientRect();
    const fly = document.createElement('div');
    fly.className='fly-letter';
    fly.textContent = ch;
    document.body.appendChild(fly);
    fly.style.transform = `translate(${fromX}px, ${fromY}px)`;
    requestAnimationFrame(()=>{
      const destX = tRect.left + tRect.width/2;
      const destY = tRect.top + tRect.height/2;
      fly.style.transform = `translate(${destX}px, ${destY}px)`;
      fly.style.opacity = '0.9';
      fly.addEventListener('transitionend', ()=>{
        target.textContent = ch;
        target.classList.add('filled');
        filledCount++;
        fly.remove();
        if(isPuzzleComplete()){
          const hint = document.querySelector('.hint');
          hint.textContent = 'K√©sz! Most m√°r kinyithatod a dobozt üéÅ';
          burstConfetti(120);
        }
      }, {once:true});
    });
  }

  balloonsWrap.addEventListener('click', (e)=>{
    const bEl = e.target.closest('.balloon');
    if(!bEl) return;
    const letter = bEl.dataset.letter;
    const rect = bEl.getBoundingClientRect();
    flyLetterToSlot(letter, rect.left+rect.width/2, rect.top+rect.height/2);
    bEl.classList.add('popped');
    burstConfetti(28, rect.left+rect.width/2, rect.top+rect.height/2);
    setTimeout(()=>bEl.remove(), 260);
  }, {passive:true});

  /* ======== MODAL gomb ======== */
  const modal = document.getElementById('taskModal');
  document.getElementById('okBtn').addEventListener('click', ()=> modal.classList.remove('show'));
  // (v√©d≈ë ellen≈ërz√©s, ha nincs ‚ÄûlaterBtn‚Äù)
  const laterBtn = document.getElementById('laterBtn');
  if(laterBtn) laterBtn.addEventListener('click', ()=> modal.classList.remove('show'));

  /* ======== T≈∞ZIJ√ÅT√âK ======== */
  const fwCanvas = document.getElementById('fireworks');
  const fctx = fwCanvas.getContext('2d');
  let fwRunning = true;
  function resizeCanvases(){
    [fwCanvas, confettiCanvas].forEach(c=>{c.width=innerWidth*devicePixelRatio; c.height=innerHeight*devicePixelRatio});
  }
  window.addEventListener('resize', resizeCanvases);

  class Spark{
    constructor(x,y,angle,speed,color){
      this.x=x; this.y=y; this.vx=Math.cos(angle)*speed; this.vy=Math.sin(angle)*speed; this.alpha=1; this.life=60 + Math.random()*20; this.color=color;
    }
    step(){ this.life--; this.x+=this.vx; this.y+=this.vy; this.vy+=0.03; this.alpha = Math.max(0, this.life/80); }
    draw(ctx){ ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, 2.2*devicePixelRatio, 0, Math.PI*2); ctx.fill(); }
  }
  const fireworks=[];
  function launchFirework(){
    const x = (Math.random()*0.7 + 0.15) * fwCanvas.width;
    const y = (Math.random()*0.25 + 0.15) * fwCanvas.height;
    const hue = Math.floor(Math.random()*360);
    const color = `hsl(${hue} 100% 70%)`;
    for(let i=0;i<80;i++){
      const ang = (i/80)*Math.PI*2 + Math.random()*0.05;
      const spd = (Math.random()*2+1.8)*devicePixelRatio*1.1;
      fireworks.push(new Spark(x,y,ang,spd,color));
    }
  }
  let fwTimer = 0;
  function fwLoop(){
    if(!fwRunning) return;
    requestAnimationFrame(fwLoop);
    fctx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
    fwTimer++;
    if (fwTimer % 42 === 0) launchFirework();
    for(let i=fireworks.length-1;i>=0;i--){
      const s = fireworks[i]; s.step(); s.draw(fctx); if(s.life<=0) fireworks.splice(i,1);
    }
  }
  function startFireworks(ms=5000){
    fwRunning = true; const endAt = performance.now()+ms;
    const tick = () => { if(performance.now()<endAt){ fwRunning = true; requestAnimationFrame(tick); } else { fwRunning=false; } };
    launchFirework(); launchFirework();
    fwLoop(); tick();
  }

  /* ======== KONFETTI ‚Äì folyamatos es√©s ======== */
  const confettiCanvas = document.getElementById('confetti');
  const cctx = confettiCanvas.getContext('2d');
  const bits=[];
  class Bit{
    constructor(x,y){
      this.x=x; this.y=y;
      this.size=(4+Math.random()*6)*devicePixelRatio;
      this.vx=(Math.random()-0.5)*0.8;
      this.vy=(0.8+Math.random()*1.8)*devicePixelRatio;
      this.rot=Math.random()*Math.PI*2;
      this.vr=(Math.random()-0.5)*0.2;
      this.color=`hsl(${Math.floor(Math.random()*360)} 100% 65%)`;
      this.life=400+Math.random()*200;
    }
    step(){
      this.life--; this.x+=this.vx; this.y+=this.vy; this.vy+=0.01*devicePixelRatio; this.rot+=this.vr;
      if(this.y > confettiCanvas.height + 10*devicePixelRatio){
        this.y = -10*devicePixelRatio; this.x = Math.random()*confettiCanvas.width; this.vy = (0.8+Math.random()*1.8)*devicePixelRatio;
      }
    }
    draw(ctx){ ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.rot); ctx.fillStyle=this.color; ctx.fillRect(-this.size/2,-this.size/2,this.size,this.size*0.6); ctx.restore(); }
  }
  function confettiLoop(){
    requestAnimationFrame(confettiLoop);
    const targetCount = Math.min(300, Math.floor((innerWidth*innerHeight)/8000));
    if(bits.length < targetCount){
      const need = targetCount - bits.length;
      for(let i=0;i<need;i++){
        const x = Math.random()*confettiCanvas.width;
        const y = Math.random()*(-confettiCanvas.height*0.3);
        bits.push(new Bit(x,y));
      }
    }
    cctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    for(let i=0;i<bits.length;i++){ const b = bits[i]; b.step(); b.draw(cctx); }
  }
  function burstConfetti(n=60, sx, sy){
    const x = (sx!==undefined? sx : innerWidth/2) * devicePixelRatio;
    const y = (sy!==undefined? sy : innerHeight*0.2) * devicePixelRatio;
    for(let i=0;i<n;i++){
      const b = new Bit(x + (Math.random()-0.5)*40*devicePixelRatio, y + (Math.random()-0.5)*20*devicePixelRatio);
      b.vx += (Math.random()-0.5)*2; b.vy = Math.abs(b.vy) + Math.random()*2*devicePixelRatio; bits.push(b);
    }
  }

  // ======== Init ========
  resizeCanvases();
  confettiLoop();
  </script>
</body>
</html>
